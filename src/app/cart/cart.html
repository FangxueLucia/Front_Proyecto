<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h2 class="m-0">Carrito</h2>

    <a class="btn btn-outline-secondary btn-sm" routerLink="/store">
      ← Seguir comprando
    </a>
  </div>

  @if (cart.items().length === 0) {
    <div class="alert alert-info">
      Tu carrito está vacío.
    </div>
  } @else {
    <div class="list-group mb-3">
      @for (item of cart.items(); track item.obra._id) {
        <div class="list-group-item">
          <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
            <!-- Info -->
            <div class="me-auto">
              <div class="fw-semibold">{{ item.obra.titulo }}</div>
              <div class="text-muted small">
                {{ item.obra.artista?.nombre || 'Anónimo' }}
              </div>
              <div class="text-muted small">
                Precio: {{ item.obra.precio ?? 0 }} €
              </div>
            </div>

            <!-- Controles cantidad -->
            <div class="d-flex align-items-center gap-2">
              <button
                class="btn btn-outline-secondary btn-sm"
                type="button"
                (click)="cart.dec(item.obra._id)"
                aria-label="Disminuir cantidad"
              >
                −
              </button>

              <input
                type="number"
                class="form-control form-control-sm text-center"
                style="width: 84px;"
                [value]="item.qty"
                min="1"
                (input)="cart.setQty(item.obra._id, $any($event.target).value)"
                aria-label="Cantidad"
              />

              <button
                class="btn btn-outline-secondary btn-sm"
                type="button"
                (click)="cart.inc(item.obra._id)"
                aria-label="Aumentar cantidad"
              >
                +
              </button>
            </div>

            <!-- Subtotal + quitar -->
            <div class="d-flex align-items-center gap-2">
              <div class="text-end" style="min-width: 110px;">
                <div class="fw-semibold">
                  {{ (item.obra.precio ?? 0) * item.qty }} €
                </div>
                <div class="text-muted small">Subtotal</div>
              </div>

              <button
                class="btn btn-outline-danger btn-sm"
                type="button"
                (click)="cart.remove(item.obra._id)"
              >
                Quitar
              </button>
            </div>
          </div>
        </div>
      }
    </div>

    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
      <div class="fw-semibold">Total:</div>
      <div class="fs-5 fw-bold">{{ cart.total() }} €</div>
    </div>

    <div class="mt-3 d-flex flex-wrap gap-2">
      <button class="btn btn-outline-secondary" type="button" (click)="cart.clear()">
        Vaciar carrito
      </button>
      <button class="btn btn-success" type="button" disabled>
        Checkout (después)
      </button>
    </div>
  }
</div>
